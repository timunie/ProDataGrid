<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:DataGridSample.Models"
             xmlns:viewModels="clr-namespace:DataGridSample.ViewModels"
             x:Class="DataGridSample.Pages.NestedDataGridPage"
             x:DataType="viewModels:NestedDataGridViewModel">
  <UserControl.DataContext>
    <viewModels:NestedDataGridViewModel/>
  </UserControl.DataContext>

  <Grid RowDefinitions="Auto,*"
        Margin="12"
        RowSpacing="8">
    <StackPanel Grid.Row="0" Spacing="4">
      <TextBlock Classes="h2">Nested DataGrid Auto-Height</TextBlock>
      <TextBlock Text="Each ListBox item hosts a DataGrid with no explicit Height. Add or remove rows to see each item resize while the outer list handles scrolling."
                 TextWrapping="Wrap" />
    </StackPanel>

    <ListBox Grid.Row="1"
             ItemsSource="{Binding Groups}">
      <ListBox.ItemContainerTheme>
        <ControlTheme TargetType="ListBoxItem">
          <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        </ControlTheme>
      </ListBox.ItemContainerTheme>
      <ListBox.ItemTemplate>
        <DataTemplate x:DataType="viewModels:NestedDataGridGroup">
          <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                  BorderThickness="1"
                  CornerRadius="6"
                  Margin="0 0 0 12"
                  Padding="8">
            <StackPanel Spacing="6">
              <DockPanel LastChildFill="False">
                <StackPanel Orientation="Horizontal" Spacing="8" DockPanel.Dock="Left">
                  <TextBlock Classes="h3" Text="{Binding Name}" />
                  <TextBlock Text="{Binding Items.Count, StringFormat='({0} rows)'}"
                             Opacity="0.7"
                             VerticalAlignment="Center" />
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="6" DockPanel.Dock="Right">
                  <Button Content="Add row" Command="{Binding AddRowCommand}" />
                  <Button Content="Remove row" Command="{Binding RemoveRowCommand}" />
                </StackPanel>
              </DockPanel>

              <DataGrid ItemsSource="{Binding Items}"
                        AutoGenerateColumns="False"
                        CanUserReorderColumns="False"
                        CanUserResizeColumns="False"
                        HeadersVisibility="Column"
                        IsReadOnly="True">
                <DataGrid.Columns>
                  <DataGridTextColumn Header="Id"
                                      Binding="{Binding Id}"
                                      Width="80"
                                      x:DataType="models:ChangeItem" />
                  <DataGridTextColumn Header="Name"
                                      Binding="{Binding Name}"
                                      Width="2*"
                                      x:DataType="models:ChangeItem" />
                  <DataGridTextColumn Header="Value"
                                      Binding="{Binding Value}"
                                      Width="*"
                                      x:DataType="models:ChangeItem" />
                </DataGrid.Columns>
              </DataGrid>
            </StackPanel>
          </Border>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>
  </Grid>
</UserControl>
